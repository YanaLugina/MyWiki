#Создание контейнера с БД Postgres

```bash
$ docker run --name some-postgres -e POSTGRES_PASSWORD=mysecretpassword -d postgres
```
```postgres``` - название бд по-умолчанию, для установки другого значения следует использовать переменную ```POSTGRES_DB```

```POSTGRES_PASSWORD``` задает пароль бд для суперпользователя

```postgres``` - это мы установили user по-умолчанию, для установки другого значения следует использовать ```POSTGRES_USER```

```POSTGRES_INITDB_ARGS``` - переменная среды, в которую можно добавить контрольную сумму страниц 

```bash
-e POSTGRES_INITDB_ARGS = "- контрольные суммы данных"
```

```POSTGRES_INITDB_WALDIR``` - переменная для установки журнала транзакций, по-умолчанию журнал хранится в подкаталоге PGDATA, в версии Postgres 9.X эта переменная называется POSTGRES_INITDB_XLOGDIR

```PGDATA``` - переменная установки места для хранения файлов БД, по умолчанию это 
```bash
/var/lib/postgresql/data
```
PS: Эта переменная не является специфичной для Docker, поскольку используется двоичным файлом сервера Postgres.

```_FILE``` - может быть добавлен к переменной среды, в результате чего скрипт инициализации загружает значения для этих переменных из файлов, присутствующих в контейнере. В частновти это может быть использовано для загрузки паролей из Docker secrets stored в `````/run/secrets/<secret_name>`````

Пример:
```bash
$ docker run --name some-postgres -e POSTGRES_PASSWORD_FILE=/run/secrets/postgres-passwd -d postgres
```
На данный момент может использоваться со следующими переменными POSTGRES_INITDB_ARGS, POSTGRES_PASSWORD, POSTGRES_USER, и POSTGRES_DB.



###Initialization scripts

Если вы хотите выполнить дополнительную инициализацию в образе, полученном из этого, добавьте один или несколько скриптов * .sql, * .sql.gz или * .sh в `````/docker-entrypoint-initdb.d````` (при необходимости создав каталог). После того, как точка входа вызовет initdb для создания пользователя и базы данных postgres по умолчанию, она запустит любые файлы * .sql, запустит любые исполняемые сценарии * .sh и найдет все неисполняемые сценарии * .sh, найденные в этом каталоге, для дальнейшей инициализации перед запуск службы.

сценарии в `````/docker-entrypoint-initdb.d````` запускаются только в том случае, если вы запускаете контейнер с пустым каталогом данных; любая ранее существующая база данных останется нетронутой при запуске контейнера. Одна из распространенных проблем заключается в том, что если один из ваших сценариев `````/docker-entrypoint-initdb.d````` завершится неудачно (что приведет к выходу сценария точки входа), и ваш оркестратор перезапустит контейнер с уже инициализированным каталогом данных, он не продолжит выполнение ваших сценариев.


###Вход в БД созданного контейнера

смотрим название нашего контейнера

```bash
docker exec -ti NAME_OF_CONTAINER psql -U YOUR_POSTGRES_USERNAME
```

то есть к вышесозданному контейнеру применима следующая команда
```bash
docker exec -ti some-postgres psql -U postgres
```
```some-postgres``` - название нашего контейнера

```postgres``` - наш пользователь

Обратите внимание, ```docker exec``` запускает команду ```psql``` в запущенном контейнере, а не в ```docker run```, который запустит новый контейнер.
И только тогда мы попадаем в cli БД Postgres.
